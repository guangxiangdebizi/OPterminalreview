# 数据库第9章 - 数据库安全

> 整理自数据库期末复习PPT

---

## 9.1 第九章 数据库安全.pptx


### 幻灯片 1

数据库原理


### 幻灯片 2

第九章    数据库安全
	9.1 数据库安全性概述
	9.2 数据库安全控制
	9.3 MYSQL 安全性
       9.4 SQL Server安全性


### 幻灯片 3

9.1 数据库安全概述
问题的提出
数据库的一大特点是数据可以共享；
数据共享必然带来数据库的安全性问题；
数据库系统中的数据共享不能是无条件的共享;
安全性问题不是数据库系统所独有的,而是所有计算机系统都有这个问题.


### 幻灯片 4

什么是数据库的安全性？
数据库的系统安全：指攻击者对数据库运行的系统环境进行攻击，使系统无法正常运行，从而导致数据库无法运行。
数据库的信息安全：主要指数据被破坏和泄露的威胁。
9.1 数据库安全概述


### 幻灯片 5

（一级一级层层设置）
用户
DBMS
OS
DB
用户标识和鉴别
存取控制
视图、审计
操作系统
安全保护
密码保护
数据库系统的安全模型
9.1 数据库安全概述


### 幻灯片 6

9.1 数据库安全概述
数据库的安全要求：
—数据库中数据的保密性。
—数据库中数据的完整性与一致性
—数据库中数据的有效性
9.1.1 数据库安全要求


### 幻灯片 7

9.1 数据库安全概述
数据库的安全威胁
—外部攻击
—权限滥用
—内部人员窃取数据
9.1.2 数据库安全威胁


### 幻灯片 8

第九章    数据库安全
	9.1 数据库安全性概述
	9.2 数据库安全控制
	9.3 MYSQL 安全性
        9.4 SQL Server安全性


### 幻灯片 9

系统提供的最外层的安全保护措施。
具体方法：
系统提供一定的方式让用户标识自己的名字或身份；
 系统内部记录着所有合法用户的标识；
 每次用户要求进入系统时，由系统核对用户提供的身份标识；
 通过鉴定后才提供机器使用权；
 用户标识和鉴定可以重复多次。
9.2 数据库安全控制
9.2.1 用户标识与鉴别


### 幻灯片 10

用户名/口令
—简单易行，容易被人窃取。
每个用户预先约定好一个计算过程或者函数：
—系统提供一个随机数；
—用户根据自己预先约定的计算过程或者函数进行计算；
—系统根据用户计算结果是否正确鉴定用户身份。
常用方法：
9.2 数据库安全控制
9.2.1 用户标识与鉴别


### 幻灯片 11

存取控制机制组成
—定义存取权限：为用户定义适当的存取权限，并登记入数据字典（安全规则或授权规则）
—合法权限检查：查找数据字典，根据安全规则进行用户合法权限检查
用户权限定义和合法权限检查机制一起组成DBMS的安全子系统。
9.2.2 存取控制
9.2 数据库安全控制


### 幻灯片 12

存取控制方法
—自主存取控制(DAC :Discretionary Access Control )：
强制存取控制(MAC : Mandatory Access Control )：
9.2.2 存取控制
9.2 数据库安全控制


### 幻灯片 13

自主存取控制(DAC)：
—定义用户存取权限：
授权：GRANT
收回权限：REVORK
—检查存取权限：对于获得上机权后又进一步发出存取数据库操作的用户：
DBMS查找数据字典，根据其存取权限对操作的合法性进行检查；
若用户的操作请求超出了定义的权限，系统将拒绝执行此操作。
9.2.2 存取控制
9.2 数据库安全控制


### 幻灯片 14

强制存取控制(MAC)：指系统为保证更高程度的安全性，按照TDI/TCSEC标准中安全策略的要求，所采取的强制存取检查手段。
  —MAC不是用户能直接感知或进行控制的。
  —MAC适用于对数据有严格而固定密级分类的部门
9.2.2 存取控制
9.2 数据库安全控制


### 幻灯片 15

视图机制把要保密的数据对无权存取这些数据的用户隐藏起来。
视图机制与授权机制配合使用:即首先用视图机制屏蔽掉一部分保密数据；在视图上再进一步定义存取权限。
9.2.3视图机制
9.2 数据库安全控制


### 幻灯片 16

【例】在配电物资表stock中如果指定U1用户只能查看供电局1#仓库的物资时，可以先建立供电局1#仓库的配电物资视图。
CREATE VIEW View_Stock1
AS 
  SELECT * 
  FROM STOCK
  WHERE warehouse=’ 供电局1#仓库’; /*先建视图*/
然后在该视图上进一步定义存取权限：

GRANT SELECT
ON View_Stock1
TO U1;
9.2.3视图机制
9.2 数据库安全控制


### 幻灯片 17

什么是审计?
—启用一个专用的审计日志（Audit Log），将用户对数据库的所有操作记录在上面；
—审计功能是一种监视措施，它跟踪记录有关数据的访问活动 。
—DBA可以利用审计日志中的追踪信息，找出非法存取数据的人、时间和内容。
注：审计很费时间和空间，DBA可以根据应用对安全性的要求，灵活地打开或关闭审计功能。
9.2.4审计
9.2 数据库安全控制


### 幻灯片 18

【例】为了保证电力抢修工程数据库中的Stock表的amount及unit字段不被非法更改，可以创建如下审计表： 
CREATE TABLE stock_audit(
ID int PRIMARY KEY auto_increment,
 /*ID 为自增长字段，SQL Server中应该写为：ID int IDENTITY(1,1) PRIMARY KEY */
username varchar(20),        change_date datetime,
mat_no char(8),                    old_amount int,
new_amount int,                   old_unit decimal(18, 2),
new_unit decimal(18, 2)
);
9.2.4审计
9.2 数据库安全控制


### 幻灯片 19

当Stock表中的amount或unit字段被更改时，可以通过如下触发器将更改信息自动写入stock_audit表中。
MySQL下触发器的实现：
DELIMITER &&
CREATE TRIGGER stock_update_audit_trigger
AFTER UPDATE
ON Stock FOR EACH ROW
BEGIN
      INSERT INTO stock_audit(username, change_date,mat_no,old_amount,
                                                    new_amount,old_unit,new_unit)
      VALUES(user(),NOW(), NEW.mat_num, OLD.amount,   NEW.amount,OLD.unit,NEW.unit);
END
9.2.4审计
9.2 数据库安全控制


### 幻灯片 20

当执行如下语句（Stock表中已经存在物资编号为’m010’的记录）： 
            UPDATE Stock SET amount=10 WHERE mat_num='m010';
Stock_audit表中会自动增加一条记录：
9.2.4审计
9.2 数据库安全控制


### 幻灯片 21

SQL Server下该触发器的实现如下：
CREATE TRIGGER stock_update_audit_trigger
ON Stock  FOR UPDATE
AS
BEGIN
    DECLARE @mat_no char(8)
   DECLARE @amount_old int ,@amount_new int  
    DECLARE @unit_old decimal(18, 2) ,@unit_new decimal(18, 2)
    IF (UPDATE(amount) OR UPDATE(unit))
    BEGIN
         SELECT @mat_no=mat_no,@amount_old=amount,@unit_old=unit   FROM DELETED
         SELECT @amount_new=amount,@unit_new=unit FROM INSERTED
         INSERT INTO stock_audit(username, change_date,mat_no,old_amount,new_amount,old_unit,new_unit)
              VALUES(user_name(),getdate(), @mat_no,@amount_old, @amount_new,@unit_old,@unit_new)
    END
END
9.2.4审计
9.2 数据库安全控制


### 幻灯片 22

考虑如下安全问题：
（1）数据库管理员可以不加限制地访问和更改数据库中的所有数据；
（2）非法用户盗取文件、磁盘区或内存中的数据；
（3）磁盘及备份设备等存储设备可能被盗窃；
（4）数据库中数据在网络传输过程中可能被窃听
如何解决？
9.2.5 数据加密
9.2 数据库安全控制


### 幻灯片 23

加密算法
—加密系统组成：明文、密文、加密/解密算法、用于加密解密的钥匙（密钥）
—对称加密算法：加密和解密使用相同密钥的加密算法，典型算法：DES、AES
—非对称加密算法：需要两个密钥：公开密钥和私有密钥，典型算法：RSA
9.2.5数据加密
9.2 数据库安全控制


### 幻灯片 24

数据库数据加密的实现
可以考虑在3个不同层次实现对数据库数据的加密：
—操作系统层
—DBMS内核层
—DBMS外层
9.2.7 数据加密
9.2 数据库安全控制


### 幻灯片 25

数据库加密系统优点
—系统对数据库的最终用户是完全透明的，管理员可以根据需要进行明文和密文的转换工作；
—加密系统完全独立于数据库应用系统，无须改动数据库应用系统就能实现数据加密功能；
—加解密处理在客户端进行，不会影响数据库服务器的效率。
9.2.7 数据加密
9.2 数据库安全控制


### 幻灯片 26

数据库加密需要考虑的问题
—数据的安全性
—加密粒度的选择：字段、记录、表
—加密数据的合理选择
—密钥的动态管理
—数据加密的透明性
9.2.7 数据加密
9.2 数据库安全控制


### 幻灯片 27

小结
本小节介绍了常用的数据库加密方法
谢谢观看！

---

## 9.2第九章 数据库安全.pptx


### 幻灯片 1

第九章    数据库安全
	9.1 数据库安全性概述
	9.2 数据库安全控制
	9.3 MYSQL 安全性
        9.4 SQL Server安全性


### 幻灯片 2

MySQL的权限系统通过下面两个阶段进行认证：
身份认证
对通过认证的合法的用户则赋予相应的权限
9.3.1 MySQL权限系统的工作原理
9.3 MySQL安全性


### 幻灯片 3

身份认证
    MySQL通过IP地址和用户名联合进行身份认证，同样的一个用户名如果来自不同的IP地址，则MySQL将其视为不同的用户。

说明：MySQL安装后默认创建的用户root@localhost，表示用户root只能从本地(localhost)进行连接才可以通过认证，此用户从其他任何主机对数据库进行的连接都将被拒绝，除非安装时选择了（Enable root access from remote machines），那创建的就是root@%用户，就表示可以从任意主机通过root用户进行连接。
9.3.1 MySQL权限系统的工作原理
9.3 MySQL安全性


### 幻灯片 4

权限表的存取：对通过认证的合法的用户则赋予相应的权限
最重要的权限表：
— user表：针对所有数据库的权限，39个字段，分为4类：用户列、安全列、资源控制列、权限列
— db表：某个用户对一个数据库的权限，22个字段，分为2类：用户列、权限列
其他权限表：
— tables_priv 表：对单个表进行权限设置
— columns_priv 表：对单个数据列进行权限设置
— procs_priv 表：对存储过程和存储函数进行权限设置
9.3.1 MySQL权限系统的工作原理
9.3 MySQL安全性


### 幻灯片 5

当用户进行连接时，权限表的存取过程分为两步：
①先从user表中的host、user和password这3个字段中判断连接的IP、用户名和密码是否存在与表中，如果存在，则通过身份验证，否则拒绝连接。
②如果通过身份验证，则按照user、db、tables_priv、columns_priv这4个权限表的顺序得到数据库权限。在这4个权限表中，权限范围依次递减，全局权限覆盖局部权限。
小技巧：如果希望用户只对某个数据库有操作权限，可以先将 user 表中对应的权限设置为 N，然后在 db 表中设置对应数据库的操作权限。
9.3.1 MySQL权限系统的工作原理
9.3 MySQL安全性


### 幻灯片 6

当用户通过权限认证，进行权限分配的具体过程:
①先检查全局权限表user，如果user中对应权限为Y，则此用户对所有数据库的权限都为Y，将不再检查db、tables_priv和columns_priv；
②如果为N，则到db表中检查此用户对应的具体数据库，并得到db中为Y的权限；
③如果db中相应权限为N，则检查tables_priv中此数据库对应的具体表，取得表中为Y的权限；
④如果tables_priv中相应的权限为N，则检查columns_priv中此表对应的具体列，取得列中为Y的权限。
9.3.1 MySQL权限系统的工作原理
9.3 MySQL安全性


### 幻灯片 7

默认超级用户：root
创建新用户
①CREATE USER <用户> [ IDENTIFIED BY  'password' ]
                         [ ,用户 [ IDENTIFIED BY  'password' ]]
【例】下列语句创建一个用户，用户名是 test1，密码是 test1，主机名是 localhost。
   CREATE USER 'test1'@'localhost' IDENTIFIED BY 'test1';
【例】下列语句创建用户test3, 可以从任何IP进行连接。
  CREATE USER 'test3'@'%' IDENTIFIED BY 'test3';
说明：新创建的用户拥有的权限很少，它们只能执行不需要权限的操作。
9.3.2 MySQL的用户管理
9.3 MySQL安全性


### 幻灯片 8

创建新用户
②使用 INSERT 语句将用户的信息添加到 mysql数据库的user 表中
【例】INSERT INTO mysql.user(Host, User,   
 authentication_string, ssl_cipher, x509_issuer,x509_subject) 
VALUES (' localhost ', 'test2', 'test2', '', '', '');
说明：
—由于 mysql 数据库的 user 表中，ssl_cipher、x509_issuer 和 x509_subject 这 3 个字段没有默认值，所以插入新记录时，一定要设置这 3 个字段的值。
—执行FLUSH PRIVILEGES;使新用户生效
—执行 FLUSH 命令需要 RELOAD 权限。
—user 表中的 User 和 Host 字段区分大小写
9.3.2 MySQL的用户管理
9.3 MySQL安全性


### 幻灯片 9

修改用户
RENAME USER <旧用户> TO <新用户>
【例】
    RENAME USER  'test1'@'localhost'  to  'user1'@'localhost‘;
9.3.2 MySQL的用户管理
9.3 MySQL安全性


### 幻灯片 10

删除用户
①DROP USER <用户1> [ , <用户2> ]…
【例】DROP USER ' user1'@'localhost'；
说明：
—使用 DROP USER 语句必须拥有 mysql 数据库的 DELETE 权限或全局 CREATE USER 权限。
—在 DROP USER 语句的使用中，若没有明确地给出账户的主机名，则该主机名默认为“%”。
②使用 DELETE 语句直接删除 mysql.user 表中相应的用户信息。
【例】DELETE FROM mysql.user 
            WHERE Host='localhost'AND User=' user1';
说明：必须拥有mysql.user 表的 DELETE 权限
9.3.2 MySQL的用户管理
9.3 MySQL安全性


### 幻灯片 11

1.给用户授权
GRANT priv_type [(column_list)] ON database.table
TO user [IDENTIFIED BY  'password'][, user[IDENTIFIED BY  'password']] ...
[WITH with_option [with_option]...]
with_option 参数：
GRANT OPTION：被授权的用户可以将这些权限赋予给别的用户；
MAX_QUERIES_PER_HOUR count：设置每个小时可以允许执行 count 次查询；
MAX_UPDATES_PER_HOUR count：设置每个小时可以允许执行 count 次更新；
MAX_CONNECTIONS_PER_HOUR count：设置每小时可以建立 count 个连接;
MAX_USER_CONNECTIONS count：设置单个用户可以同时具有的 count 个连接。
说明：
如果权限被授予给一个不存在的用户，MySQL 会自动执行一条 CREATE USER 语句来创建这个用户，但同时必须为该用户设置密码。
9.3.3 MySQL的权限管理
9.3 MySQL安全性


### 幻灯片 12

MySQL 中可以授予的权限：
列权限:SELECT、INSERT 和 UPDATE。
—表权限：SELECT、INSERT、DELETE、DROP、UPDATE、ALTER、REFERENCES、CREATE、INDEX、ALL PRIVILEGES / ALL/SUPER
数据库权限: SELECT、INSERT、DELETE、DROP、UPDATE、ALTER、REFERENCES、CREATE、INDEX、 ALL PRIVILEGES / ALL/SUPER…………
用户权限，数据库权限+CREATE USER+SHOW DATABASES
9.3.3 MySQL的权限管理
9.3 MySQL安全性


### 幻灯片 13

【例】①创建新用户test2，密码为test2,只能从本地进行连接。
      CREATE USER 'test2'@'localhost' IDENTIFIED BY 'test2';
②从user表中查看test2的用户权限：
      SELECT * FROM USER WHERE User='test2';


③给test2赋予可以在所有数据库上执行所有操作的权限
     GRANT ALL PRIVILEGES ON *.* TO test2@localhost;
可以发现除了Grant_priv权限外，所有权限在user表里面都是Y.
④ 增加对test2的grant权限
    GRANT ALL PRIVILEGES ON *.* TO test2@localhost WITH GRANT OPTION;
当用户test2登录时，可以将相关权限转赋给其他用户。
9.3.3 MySQL的权限管理
9.3 MySQL安全性


### 幻灯片 14

2.查看用户权限
—通过查看 mysql.user 表中的数据记录来查看相应的用户权限
【例】SELECT * FROM mysql.user;
—使用 SHOW GRANTS 语句查询用户的权限。
【例】SHOW GRANTS FOR 'test2'@'localhost';
9.3.3 MySQL的权限管理
9.3 MySQL安全性


### 幻灯片 15

3.收回用户权限
①收回用户某些特定的权限：
REVOKE priv_type [(column_list)] … ON database.table  FROM user [, user]…
【例】 REVOKE INSERT ON *.* FROM  'test2' @'localhost';
②删除特定用户的所有权限
REVOKE ALL PRIVILEGES, GRANT OPTION FROM user [, user] ...
【例】REVOKE ALL PRIVILEGES, GRANT OPTION FROM  'test2' @'localhost';
9.3.3 MySQL的权限管理
9.3 MySQL安全性


### 幻灯片 16

1.创建角色  
 CREATE ROLE 'role_name'[@'host_name'] [,'role_name'[@'host_name']]...
如果 host_name省略，默认为% 
【例】CREATE ROLE 'students'@'localhost';
2.给角色赋予权限
GRANT privileges ON table_name TO 'role_name'[@'host_name'];
【例】GRANT select ON *.* TO 'student'@'localhost';
3.查看角色的权限
SHOW GRANTS  FOR  <角色>
【例】SHOW GRANTS for 'student'@'localhost';
9.3.4 MySQL的角色管理
9.3 MySQL安全性


### 幻灯片 17

4. 回收角色的权限
   REVOKE privileges ON tablename FROM 'rolename';
【例】REVOKE select on *.* FROM 'student'@'localhost';
5.删除角色：DROP ROLE role [,role2]...
6.给用户赋予角色：GRANT role [,role2,...] TO user [,user2,...];
【例】GRANT  test1@localhost to 'student'@'localhost';
7.激活角色：SET DEFAULT ROLE <角色> TO <用户>
【例】SET DEFAULT ROLE ALL TO 'student'@'localhost';
8.撤销用户的角色：REVOKE <角色> FROM <用户>
【例】REVOKE student'@'localhost'  FROM  test2@localhost;
9.3.4 MySQL的角色管理
9.3 MySQL安全性


### 幻灯片 18

小结
本小节我们学习了MYSQL的安全管理策略，包括MySQL权限的工作原理、用户管理、权限管理、角色管理，同学们课后还需要通过实验来巩固所学的内容。
谢谢观看！

---

## 9.3第九章 数据库安全.pptx


### 幻灯片 1

第九章    数据库安全
	9.1 数据库安全性概述
	9.2 数据库安全控制
	9.3 MYSQL 安全性
        9.4 SQL Server安全性


### 幻灯片 2

1.Windows身份验证模式—默认(安全)
    用户通过Microsoft Windows用户帐户连接时，SQL Server使用Windows操作系统中的信息验证帐户名和密码。

2.混合验证模式
    混合验证模式下，当客户端连接到服务器时，既可采取Windows身份验证，也可采取SQL Server身份验证。如果必须选择"混合模式"并要求使用SQL Server帐户登录，则必须为所有的SQL Server帐户设置强密码。
9.4  SQL Server 安全性
9.4.1 SQL Server身份验证模式


### 幻灯片 3

SQL Server的安全性主体主要有三个级别 ：
—服务器级别
     所含的安全对象主要有登录名、固定服务器角色等，其中登录名用于登录数据库服务器，而固定服务器角色用于给登录名赋予相应的服务器权限。
—数据库级别
     所含的安全对象主要有用户、角色、应用程序角色、证书、对称密钥、非对称密钥、程序集、全文目录、DDL事件、架构等。
—架构级别
     所含的安全对象主要有表、视图、函数、存储过程、类型、聚合函数等。系统默认架构为dbo。
9.4  SQL Server 安全性
9.4.2 SQL Server的安全机制


### 幻灯片 4

一个数据库使用者，想要登录SQL Server服务器上的数据库，并对数据库中的表执行操作，则该使用者必须经过下图所示的安全验证：
9.4  SQL Server 安全性
9.4.2 SQL Server的安全机制


### 幻灯片 5

在SQL Server中，有登录用户和数据库用户两个概念。一个用户必须首先是一个数据库系统的登录用户，然后才可以访问某一个具体的数据库。
登录用户:由系统管理员管理；
数据库用户:由数据库管理员管理。
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 6

1.登录用户的管理
  SQL Server 有两个常用的默认登录名： 
sa：系统管理员，拥有操作SQL Server系统的所有权限，该登录名不能被删除。

  BUILTIN\Administrator：SQL Server为每个Windows系统管理员提供的默认用户账户，在SQL Server中拥有系统和数据库的所有权限。
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 7

—创建新的SQLServer登录用户

CREATE LOGIN login_name 
{   WITH PASSWORD=password
     [ , DEFAULT_DATABASE = database 
       | DEFAULT_LANGUAGE = language ]
       |FROM  WINDOWS 
     [ WITH DEFAULT_DATABASE = database
               | DEFAULT_LANGUAGE = language ]
}
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 9

—创建Windows验证模式登录名
         使用FROM子句，WINDOWS关键字指定将登录名映射到Windows登录名。
【例】假设本地计算机名为student_1，S1是一个已经创建的Windows用户，创建Windows验证模式下的登录名S1，默认数据库是master：
     CREATE LOGIN   [student_1\S1]  
     FROM  WINDOWS  
     WITH   DEFAULT_DATABASE=master
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 10

—创建SQL Server验证模式登录名
   【例】创建SQL Server登录名S2，密码为123456，默认数据库是sample：
     CREATE LOGIN  s2 
     WITH password='123456',   
     DEFAULT_DATABASE=sample
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 11

—删除登录名
语法格式如下：
　　DROP LOGIN login_name

【例】删除Windows登录名S1：
          　DROP LOGIN [student_1\S1]

　　删除SQL Server登录名S2:
        　 DROP LOGIN  S2
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 12

2.数据库用户的管理
—创建数据库用户

CREATE USER user_name
[ {  FOR | FROM }  LOGIN  login_name  |  WITHOUT LOGIN ]
[ WITH DEFAULT_SCHEMA = schema_name ]
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 14

【例】使用SQL Server登录名s2（假设已经创建）在Sample数据库中创建数据库用户u1，默认架构为dbo：
USE  sample 
GO
　CREATE USER u1 
　FROM  LOGIN  s2
　WITH DEFAULT_SCHEMA =dbo
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 15

—删除数据库用户

格式如下：
    DROP USER user_name

例：删除sample数据库的用户u1：
  USE sample
  GO
     DROP USER  u1
9.4  SQL Server 安全性
9.4.3 SQL Server用户管理


### 幻灯片 16

1.定义角色
其格式是：
CREATE ROLE role_name [AUTHORIZATION  owner_name]
例：在sample 数据库中创建角色student_role，所有者为dbo：
USE  sample
GO
CREATE ROLE student_role
  AUTHORIZATION dbo
数据库角色是被命名的一组与数据库操作相关的权限，角色是权限的集合。可用一组具有相同权限的用户创建一个角色，以便简化授权的过程。
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 17

2. 为用户指定角色
可以将数据库用户指定为数据库角色的成员：
SP_ADDROLEMEMBER    role_name ,  user_account 

例：使用Windows验证模式的登录名student\s1创建sample数据库的用户student\s1，并将该用户添加到角色student_role中：
USE sample 
GO
CREATE USER [student\s1]
FROM LOGIN [student\s1]
SP_ADDROLEMEMBER   ‘student_role’ ,’ student\s1’
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 18

3.取消用户的角色
   　　如果某个用户不再担当某个角色，可以取消用户的角色，或者说从角色中删除用户。
SP_DROPROLEMEMBER    role_name ,  user_name
例：取消用户s1的student_role角色：
SP_DROPROLEMEMBER  ‘student_role’ ,’ student\s1’
4.删除角色
   　　如果当前数据库中的某个角色不再需要，则可以删除该角色。
　　DROP ROLE　role_name
 例:  DROP ROLE  student_role
注：不能删除带有成员的角色；也不能删除固定角色及public角色。
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 19

5.固定服务器角色

**表格内容：**

固定服务器角色 | 描述
SYSADMIN | 系统管理员,拥有所有操作权限,可执行任何活动.
SERVERADMIN | 服务器管理员,可以设置服务器范围的配置选项，关闭服务器。
SETUPADMIN | 安装程序管理员,可以管理链接服务器和启动过程。
SECURITYADMIN | 安全管理员,可以管理登录和 CREATE DATABASE 权限，还可以读取错误日志和更改密码。
PROCESSADMIN | 进程管理员,可以管理在 SQL Server 中运行的进程。
DBCREATOR | 数据库创建者,可以创建、更改和除去数据库。
DISKADMIN | 磁盘管理员,可以管理磁盘文件。
BULKADMIN | 块数据操作管理员,可以执行 BULK INSERT 语句。
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 21

可以把登录名添加到固定服务器角色中，使得登录名作为固定服务器角色的成员继承固定服务器角色的权限。 
语法如下：
　　SP_ADDSRVROLEMEMBER   login, role
例：将登录JOHN指定为SYSADMIN固定服务器角色的成员，则以JOHN登录名登录系统的用户将自动拥有系统管理员权限：
SP_ADDSRVROLEMEMBER  ' JOHN ', 'SYSADMIN‘
将固定服务器角色的某个成员删除 。
语法如下：
　　SP_DROPSRVROLEMEMBER  login , role
例：从 sysadmin 固定服务器角色中删除登录JOHN。
SP_DROPSRVROLEMEMBER  ' JOHN ', ' SYSADMIN'
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 22

6. 固定数据库角色

**表格内容：**

固定数据库角色 | 描述
DB_OWNER | 数据库所有者，在数据库中有全部权限。
DB_ACCESSADMIN | 访问权限管理员，可以添加或删除用户 ID。
DB_SECURITYADMIN | 安全管理员，可以管理全部权限、对象所有权、角色和角色成员资格。
DB_DDLADMIN | 数据库对象管理员，可以发出 ALL DDL，但不能发出 GRANT、REVOKE 或 DENY 语句。
DB_BACKUPOPERATOR | 数据库备份，可以发出 DBCC、CHECKPOINT 和 BACKUP 语句。
DB_DATAREADER | 数据检索操作员，可以选择数据库内任何用户表中的所有数据。
DB_WRITER | 数据维护操作员，可以更改数据库内任何用户表中的所有数据。
DB_DENYDATAREADER | 拒绝执行数据检索操作员，不能选择数据库内任何用户表中的任何数据。
DB_DENYDATAWRITER | 拒绝执行数据维护操作员，不能更改数据库内任何用户表中的任何数据。
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 24

7. PUBLIC角色
   　　SQL Server有一个特殊的角色即PUBLIC角色。 PUBLIC角色有两大特点：
—初始状态时没有权限；
—所有的数据库用户都是它的成员。
注：当为public角色授权时，实际上是为所有的数据库用户授权。
9.4  SQL Server 安全性
9.4.4  SQL Server角色管理


### 幻灯片 25


**表格内容：**

对 象 | 常 用 权 限
数据库 | BACKUP DATABASE、BACKUP LOG、
CREATE DATABASE、CREATE DEFAULT、
CREATE FUNCTION、CREATE PROCEDURE、
CREATE RULE、CREATE TABLE、CREATE VIEW 、ALTER TABLE
表 | SELECT、DELETE、INSERT、UPDATE、
REFERENCES
视图 | SELECT、DELETE、INSERT、UPDATE、
REFERENCES
常用数据库对象的权限 ：
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 26

1.授予语句权限
　语句授权的命令格式是：
      GRANT { ALL | statement [ ,...n ] }   TO account [ ,...n ]

例：系统管理员给用户 Mary 和 John 授予多个语句权限：

     GRANT CREATE DATABASE, CREATE TABLE  
　　TO Mary, John
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 27

2.授予对象权限
    　　处理数据或执行存储过程中需要相应对象的操作或执行权限，这些权限可以划分为：
SELECT、INSERT、UPDATE和DELETE语句权限，可以应用到整个表或视图；
SELECT和UPDATE语句权限，可以有选择性地应用到表或视图中的某些列上；
INSERT和DELETE语句权限，会影响整行，因此只可以应用到表或视图中，而不能应用到单个列上。
EXECUTE语句权限，执行存储过程和函数的权限。
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 28

例：在电力工程抢修数据库中：
（1）将out_stock表的SELECT权限授予public角色。
      GRANT SELECT ON out_stock TO public 

（2）将out_stock表的INSERT, UPDATE, DELETE权限授予用户 Mary、John。
   GRANT INSERT, UPDATE, DELETE ON out_stock  TO  Mary, John

（3）将对表out_stock的get_date列的修改权限授予用户Tom。
     GRANT UPDATE (get_date) ON out_stock 
     To Tom
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 29

例：把对表stock的insert权限授予用户U1，并允许将此权限授予其他用户。
Grant  insert  On stock  To U1
With grant option;
U1可将此权限授予U2：
Grant  insert On stock  To U2
With grant option;
U2可将此权限授予U3：
Grant  insert On stock  To U3;
-->U1--> U2--> U3
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 30

【例】用户 Jean 拥有表 Plan_Data。Jean 将表 Plan_Data 的 SELECT 权限授予 Accounting 角色（指定 WITH GRANT OPTION 子句）。用户 Sunny是 Accounting 的成员，他要将表 Plan_Data 上的 SELECT 权限授予用户 Jack，Jack 不是 Accounting 的成员。
/* User Jean */
GRANT SELECT ON Plan_Data TO Accounting WITH GRANT OPTION
    因为对表 Plan_Data 用 GRANT 语句授予其他用户 SELECT 权限的权限是授予 Accounting 角色而不是显式地授予Sunny，不能因为已授予 Accounting 角色中成员该权限，而使 Sunny能够授予表的权限。Sunny必须用 AS 子句来获得 Accounting 角色的授予权限。
/* User Sunny */
GRANT SELECT ON Plan_Data TO Jack AS Accounting
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 31

【例】把用户U1对表stock的insert权限收回。
Revoke  insert  On   stock  From U1;
权限的级联回收：
         系统将自动收回直接或间接从U1处获得的对Stock表的INSERT权限:
         <--U1<-- U2<-- U3
注：若U2和U3从其他用户处获得对Stock表的insert权限，则不会回收。
9.4  SQL Server 安全性
9.4.5  权限管理
3.收回权限
    包括收回对象权限和收回语句权限


### 幻灯片 32

【例】 废除已授予用户 Joe 的 CREATE TABLE 权限：
REVOKE CREATE TABLE FROM Joe

【例】废除授予多个用户的多个语句权限：
REVOKE CREATE TABLE, CREATE DEFAULT
FROM Mary, John
9.4  SQL Server 安全性
9.4.5  权限管理


### 幻灯片 33

【例】禁止用户Mary和John对out_stock表的UPDATE、DELETE操作：
             DENY  UPDATE, DELETE  ON out_stock  TO Mary, John
  对所有 Accouting 角色成员拒绝 CREATE TABLE 权限：
            DENY CREATE TABLE TO Accounting    
        如果使用 DENY 语句禁止用户获得某个权限，那么以后将该用户添加到已得到某权限的组或角色时，该用户也不能自动这个权限。
              如果要解除由于DENY语句产生的禁止效果，必须使用GRANT命令为禁止的用户或角色显式授予相应的权限。
9.4  SQL Server 安全性
9.4.5  权限管理
4.禁止权限
    包括禁止对象权限和禁止语句权限


### 幻灯片 34

小结
实现数据库系统安全的技术和方法有多种，最重要的是存取控制技术、视图技术和审计技术。自主存取控制一般通过SQL的GRANT语句和REVOKE语句来实现，
谢谢观看！

---

