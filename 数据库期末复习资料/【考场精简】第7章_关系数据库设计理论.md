# 【考场精简】第7章 关系数据库设计理论

## ⭐⭐⭐ 本章是大题/简答题主战场！必须掌握！

**核心考点：** 函数依赖（完全/部分/传递）、1NF/2NF/3NF判断、范式拆解步骤

---

## 考场做题速查卡（先看这个！）

### 题型1：判断关系属于第几范式
1. 写出所有函数依赖
2. 找候选码，分清主属性和非主属性
3. 检查部分依赖（看2NF）
4. 检查传递依赖（看3NF）

### 题型2：将关系分解到3NF
1. 先判断当前属于第几范式
2. 如果是1NF，找**部分依赖**，拆成2NF
3. 如果是2NF，找**传递依赖**，拆成3NF
4. **记住：** 必须按顺序拆，不能跳步！

### 关键口诀
- **部分依赖：** 码的真子集能决定非主属性
- **传递依赖：** 非主属性决定非主属性
- **拆表原则：** 把有问题的依赖分离出去，形成新表

---

## 一、问题的提出

**不好的数据库模式存在的问题：**
1. **数据冗余太大** - 浪费大量存储空间
2. **更新异常** - 更新代价大，可能导致数据不一致
3. **插入异常** - 该插的数据插不进去
4. **删除异常** - 不该删除的数据不得不删，造成某些数据丢失

**典型例题：** WAE关系模式 - WAE(仓库号, 所在区域, 区域主管, 设备号, 数量)。语义规定一个区域有多个仓库，一个仓库只能属于一个区域；一个区域只有一个区域主管；一个仓库可以存放多种设备，每种设备可以存放在多个仓库中；每个仓库的每种设备都有一个库存数量。这个模式存在上述所有问题。

**解决方法：** 通过分解关系模式来消除其中不合适的数据依赖。应该分解为三个关系模式：W(仓库号, 所在区域)、A(区域, 区域主管)、WE(仓库号, 设备号, 数量)。

---

## 二、函数依赖核心概念

### 1. 函数依赖定义

**函数依赖 X→Y：** 设R(U)是一个属性集U上的关系模式，X和Y是U的子集。若对于R(U)的任意一个可能的关系r，对任意两个元组t1和t2，若t1[X]=t2[X]，则t1[Y]=t2[Y]，则称X函数决定Y或Y函数依赖X，记作X→Y。X称为决定因素。

**三点说明：** 函数依赖是语义范畴的概念，只能根据数据的语义来确定；函数依赖不是指关系模式R的某个或某些关系实例满足的约束条件，而是指R的所有关系实例均要满足的约束条件；函数依赖存在时间无关性。

**函数依赖与属性间联系类型的关系：**
- 若属性X和Y之间有一对一的联系，则X→Y且Y→X，即X↔Y
- 若属性X和Y之间有多对一的联系，则X→Y，但Y不能推出X
- 若属性X和Y之间有多对多的联系，则X与Y之间不存在任何函数依赖

### 2. 函数依赖的分类

**平凡函数依赖与非平凡函数依赖：**
- **非平凡函数依赖：** 若X→Y，但Y不是X的子集，则称X→Y是非平凡函数依赖
- **平凡函数依赖：** 若X→Y，但Y是X的子集，则称X→Y是平凡函数依赖
- 注意：对任一关系模式，平凡函数依赖必然存在，一般讨论非平凡函数依赖

**完全函数依赖与部分函数依赖：** ⭐⭐⭐ 决定2NF
- **完全函数依赖：** 若X→Y，并且对于X的任何一个真子集X'，都有X'不能推出Y，则称Y完全函数依赖于X
  - 例：(学号, 课程号)→成绩，成绩必须依赖两个属性才能确定
- **部分函数依赖：** 若X→Y，但Y不完全函数依赖于X，则称Y部分函数依赖于X
  - 例：(学号, 课程号)→姓名，实际上学号就能确定姓名，这就是部分依赖
- **识别关键：** 看非主属性是否依赖于码的真子集

**传递函数依赖与直接函数依赖：** ⭐⭐⭐ 决定3NF
- **传递函数依赖：** 若X→Y，Y→Z，且Y不能推出X(即不是X↔Y)，则称Z对X传递函数依赖
  - 例：学号→系名→系主任（学号通过系名间接决定系主任）
  - **关键条件：** Y不能推出X，否则就不是传递依赖
- **直接函数依赖：** 如果Y→X(即X↔Y)，则Z对X直接函数依赖
- **识别关键：** 看是否存在 非主属性→非主属性 的依赖链

### 3. 码的概念

**候选码：** 设K为R<U,F>中的属性或属性组合，若K完全函数依赖推出U，则K称为R的一个候选码。

**主码：** 若关系模式R有多个候选码，则选定其中的一个作为主码。

**主属性：** 包含在任何一个候选码中的属性称为主属性。

**非主属性：** 不包含在任何一个候选码中的属性称为非主属性。

**全码：** 整个属性组全是码的情况称为全码。

---

## 三、范式与规范化

**范式定义：** 范式是符合某一种级别的关系模式的集合，是对关系数据库的规范化过程中为不同程度的规范化要求设立的不同标准。

**范式之间的关系：** 5NF ⊂ 4NF ⊂ BCNF ⊂ 3NF ⊂ 2NF ⊂ 1NF

**规范化：** 通过模式分解将一个低一级范式的关系模式转换为若干个高一级范式的关系模式集合的过程。

### 1. 第一范式（1NF）

**定义：** 如果一个关系模式R的所有属性都是不可分的基本数据项，则R∈1NF。

**说明：** 第一范式是对关系模式的最起码要求。不满足第一范式的数据库模式不能称为关系数据库。但满足第一范式的关系模式并不一定是一个好的关系模式。

### 2. 第二范式（2NF）⭐⭐⭐

**定义：** 若关系模式R∈1NF，并且每一个非主属性都**完全函数依赖**于R的码，则R∈2NF。

**核心要点：** 消除非主属性对码的**部分函数依赖**。

**识别技巧：** 当候选码是组合属性（多个属性组成）时，检查非主属性是否依赖于码的真子集。

**例题：** WAE(仓库号, 所在区域, 区域主管, 设备号, 数量)
- 码：(仓库号, 设备号)
- 主属性：仓库号、设备号
- 非主属性：所在区域、区域主管、数量
- 存在部分依赖：仓库号→所在区域，仓库号→区域主管（只依赖码的一部分）
- 结论：WAE∈1NF，但不属于2NF

**分解方法：** 
- WE(仓库号, 设备号, 数量) - 数量完全依赖于(仓库号, 设备号)
- WA(仓库号, 所在区域, 区域主管) - 所在区域、区域主管依赖于仓库号
- 结果：WE∈2NF, WA∈2NF

**⚠️ 注意：** 分解到2NF并不能完全消除异常！WA中仍存在问题（需要继续分解到3NF）。

### 3. 第三范式（3NF）⭐⭐⭐

**定义：** 如果关系模式R∈2NF，且每个非主属性都不**传递函数依赖**于R的候选码，则R∈3NF。

**核心要点：** 消除非主属性对码的**传递函数依赖**。

**识别技巧：** 检查是否存在 X→Y→Z 这样的依赖链，其中X是码，Y和Z都是非主属性。

**例题：** WA(仓库号, 所在区域, 区域主管)
- 码：仓库号
- 主属性：仓库号
- 非主属性：所在区域、区域主管
- 存在传递依赖：仓库号→所在区域→区域主管（非主属性决定非主属性）
- 结论：WA∈2NF，但不属于3NF

**分解方法：** 
- W(仓库号, 所在区域) - 直接依赖
- A(所在区域, 区域主管) - 直接依赖
- 结果：W∈3NF, A∈3NF

**⚠️ 易错点：** 传递依赖的关键是中间环节Y不能推出X（即不是X↔Y）。如果Y→X，那就不是传递依赖，而是直接依赖。

### 4. BC范式（BCNF）- 了解即可

**定义：** 设关系模式R∈1NF，若对于R的每个函数依赖X→Y，若Y不属于X，则X必含有候选码，那么R∈BCNF。

**核心要点：** 每一个决定因素都包含码。消除了主属性对码的部分和传递依赖。

**重要结论：** 若R∈BCNF则R∈3NF；若R∈3NF则R不一定属于BCNF。任何二元关系必定属于BCNF。

**例题：** WES(仓库号, 设备号, 职工号)。职工号→仓库号，(仓库号,设备号)→职工号。码为(仓库号,设备号)。属于3NF但不属于BCNF（因为职工号→仓库号中，职工号不包含候选码）。

### 5. 多值依赖与第四范式（4NF）- 了解即可

**多值依赖定义：** X→→Y表示给定X的值，对应一组Y值，且这组值与其他属性无关。

**典型例题：** Teaching(C, T, B)表示课程C、教师T和参考书B。某课程由多个教师讲授，使用相同参考书。C→→T且C→→B。全码(C,T,B)，属于BCNF但存在数据冗余和各种异常。

**多值依赖的性质：**
1. **对称性：** 若X→→Y，则X→→Z，其中Z=U-X-Y
2. **函数依赖是多值依赖的特殊情况：** 若X→Y，则X→→Y

**第四范式定义：** 关系模式R∈1NF，如果对于R的每个非平凡多值依赖X→→Y，X都含有候选码，则R∈4NF。

**拆解方法：** Teaching分解为CT(C,T)和CB(C,B)，都属于4NF。

---

## 四、规范化实战方法（重点掌握）

**规范化的基本思想：** 采用"一事一地"的模式设计原则，让一个关系描述一个概念、一个实体或者实体间的一种联系。若多于一个概念就把它"分离"出去。规范化实质上是概念的单一化。

### ⭐ 规范化的基本步骤（必须按顺序！）

**第一步：确保1NF** - 所有属性都是不可分的基本数据项

**第二步：1NF → 2NF** - 消除非主属性对码的**部分函数依赖**
- 方法：将部分依赖的属性分离出去，形成新的关系

**第三步：2NF → 3NF** - 消除非主属性对码的**传递函数依赖**
- 方法：将传递依赖的属性分离出去，形成新的关系

**第四步（了解）：3NF → BCNF** - 消除主属性对码的部分和传递函数依赖

**第五步（了解）：BCNF → 4NF** - 消除非平凡且非函数依赖的多值依赖

**⚠️ 重要提醒：** 规范化必须逐步进行，不能跳步！考试主要考查1NF→2NF→3NF的过程。

---

## 五、判断范式的标准步骤（简答题必考）

**给定关系模式和函数依赖集合，判断达到的最高范式：**

**步骤1：** 求出给定关系的函数依赖和候选码（可能不止一个）

**步骤2：** 根据码，写出主属性和非主属性

**步骤3：** 判断是否满足第一范式（属性的值域是否可以分解）

**步骤4：** 判断是否满足第二范式（检查：非主属性对码是否有部分函数依赖）

**步骤5：** 判断是否满足第三范式（检查：非主属性对码是否有传递函数依赖）

**步骤6：** 判断是否满足BCNF范式（检查：主属性对码的传递和部分函数依赖，即决定因素是否都包含候选码）

---

## 六、关系模式拆解标准流程（大题核心！）

### ⭐ 必须按照 1NF → 2NF → 3NF 顺序拆解，不能跳步！

**拆解原则：** 采用投影分解法，将一个低级范式关系分解为多个高级范式关系。

### 完整拆解流程示例

**原始关系：** WAE(仓库号, 所在区域, 区域主管, 设备号, 数量)

**步骤1：写出所有函数依赖**
- 仓库号 → 所在区域
- 所在区域 → 区域主管
- 仓库号 → 区域主管（传递）
- (仓库号, 设备号) → 数量

**步骤2：找出候选码**
- 候选码：(仓库号, 设备号)
- 主属性：仓库号、设备号
- 非主属性：所在区域、区域主管、数量

**步骤3：判断当前属于哪个范式**
- 属性不可再分 → 满足1NF
- 存在部分函数依赖：仓库号 → 所在区域（非主属性对码的真子集依赖）
- 结论：属于1NF，不属于2NF

**步骤4：拆解到2NF（消除部分函数依赖）**
- 找出所有部分函数依赖，将它们分离出去
- WE(仓库号, 设备号, 数量) - 码是(仓库号, 设备号)，数量完全依赖于码
- WA(仓库号, 所在区域, 区域主管) - 码是仓库号
- 现在两个关系都是2NF

**步骤5：检查2NF关系是否存在传递依赖**
- WE：无传递依赖 → 已经是3NF
- WA：存在传递依赖 仓库号 → 所在区域 → 区域主管
- 结论：WE∈3NF，WA∈2NF但不属于3NF

**步骤6：继续拆解到3NF（消除传递函数依赖）**
- 将WA中的传递依赖分离
- W(仓库号, 所在区域) - 码是仓库号
- A(所在区域, 区域主管) - 码是所在区域
- 现在三个关系都是3NF

**最终结果：**
- W(仓库号, 所在区域) ∈ 3NF
- A(所在区域, 区域主管) ∈ 3NF
- WE(仓库号, 设备号, 数量) ∈ 3NF

### 拆解口诀（考场速记）

**1NF → 2NF：** 看部分依赖，把"码的真子集能决定的非主属性"拆出去

**2NF → 3NF：** 看传递依赖，把"非主属性决定非主属性"的中间环节拆出去

**记住：** 拆解后的每个关系都要保留原来的码或者新的候选码！

---

## 七、典型大题练习（必练！考试原题类型）

**练习1：** 已知关系模式R<U,F>，U={A,B,C,D}，F={AB→D, AC→BD, B→C}。在函数依赖范围内该关系属于的最高范式是什么？

**解答：** 关系r的候选码为AB和AC。主属性为A、B、C，非主属性为D。判断：R的所有属性值域都不可再分，则r∈1NF；非主属性D不存在对任何码的部分函数依赖，则r∈2NF；非主属性D不存在对任何码的传递函数依赖，则r∈3NF；因为有函数依赖B→C，而B不是关系R的码，则r不属于BCNF。结论：r∈3NF。

**练习2：** 已知关系模式R<U,F>，U={A,B,C,D,E,F}，F={A→B, C→DF, AC→E, D→F}。在函数依赖范围内该关系属于的最高范式是什么？

**解答：** 关系r的候选码为AC。主属性为A、C，非主属性为B、D、E、F。判断：R的所有属性值域都不可再分，则r∈1NF；由于存在函数依赖A→B和C→DF，而A和C均不是关系的码，存在非主属性B、D、F对码的部分函数依赖，则r不属于2NF。结论：r∈1NF。

**练习3：** 某商业集团数据库中有一关系模式R，R(商店编号, 商品编号, 数量, 部门编号, 负责人)。规定：每个商店的每种商品只在一个部门销售；每个商店的每个部门只有一个负责人；每个商店的每种商品只有一个库存数量。

**问题1：** 写出关系模式R的基本函数依赖。
**解答：** (商店编号, 商品编号)→部门编号；(商店编号, 部门编号)→负责人；(商店编号, 商品编号)→数量。

**问题2：** 找出关系模式R的候选码。
**解答：** R的候选码为(商店编号, 商品编号)。

**问题3：** 关系模式R最高已经达到第几范式？为什么？
**解答：** 因为R中存在着非主属性"负责人"对候选码(商店编号, 商品编号)的传递函数依赖，但无部分函数依赖，所以R属于2NF，R不属于3NF。

**问题4：** 如果R不属于3NF，请将R分解成3NF模式集。
**解答：** 将R分解为R1(商店编号, 商品编号, 数量, 部门编号)和R2(商店编号, 部门编号, 负责人)。

---

## 八、考前速记重点（背熟！）

### ⭐ 三种函数依赖（必考）
1. **完全函数依赖：** X→Y，且X的任何真子集都不能推出Y
2. **部分函数依赖：** X→Y，但X存在真子集也能推出Y
3. **传递函数依赖：** X→Y，Y→Z，且Y不能推出X

### ⭐ 三个范式的核心区别（必考）
1. **1NF：** 属性不可再分
2. **2NF：** 1NF + 消除非主属性对码的**部分函数依赖**
3. **3NF：** 2NF + 消除非主属性对码的**传递函数依赖**

### ⭐ 拆表步骤（必考）
- **1NF → 2NF：** 找部分依赖，拆出"码的真子集决定的非主属性"
- **2NF → 3NF：** 找传递依赖，拆出"非主属性决定非主属性"的链条
- **记住：** 必须按顺序，不能跳步！

### ⭐ 判断范式流程（必考）
1. 求候选码
2. 分清主属性和非主属性
3. 检查部分依赖（决定2NF）
4. 检查传递依赖（决定3NF）

### 其他重要结论
- **函数依赖只能根据语义确定**，不能只看数据实例
- **任何二元关系必定属于BCNF**
- **全是主属性的关系必定是3NF**
- **范式包含关系：** 5NF ⊂ 4NF ⊂ BCNF ⊂ 3NF ⊂ 2NF ⊂ 1NF
- **多值依赖对称性：** 若X→→Y，则X→→Z（Z=U-X-Y）

