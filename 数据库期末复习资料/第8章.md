# 【复习精编】第8章 - 数据库设计

> 数据库期末复习 - 核心知识点整理

---

## 一、数据库设计概述

### 1.1 数据库设计的概念

**定义**：
- 对于一个给定的应用环境，构造最优的数据库模式
- 建立数据库及其应用系统
- 使之能够有效地存储数据，满足各种用户的应用需求（信息要求和处理要求）

**目标**：
- 为用户和各种应用系统提供一个信息基础设施和高效率的运行环境

### 1.2 数据库设计的特点

#### 结构设计和行为设计相结合

**结构设计（数据设计）**：
- 设计数据库框架或数据库结构
- 包括概念设计、逻辑设计和物理设计
- 静态和稳定的，一经形成不易改变

**行为设计（处理设计）**：
- 设计应用程序、事务处理等
- 通过应用程序实现对数据库的操作
- 动态的

**早期设计问题**：
- 传统软件工程忽视对数据语义的分析
- 早期数据库设计忽视对行为的设计

**数据库建设的基本规律**：
```
三分技术，七分管理，十二分基础数据
```
- 管理：项目管理、业务管理
- 基础数据：收集、整理、组织和不断更新

### 1.3 数据库设计的方法

#### 1. 直观设计法（早期方法）
- ❌ 设计质量与设计人员经验直接相关
- ❌ 缺乏科学理论和工程方法支持
- ❌ 维护代价高

#### 2. 规范设计法
**基本思想**：过程迭代和逐步求精

**典型方法**：
- 新奥尔良方法
- 基于E-R模型的数据库设计方法
- 3NF（第三范式）的设计方法

#### 3. 计算机辅助设计法
- Rational Rose
- PowerDesigner
- Oracle Designer

### 1.4 数据库设计的步骤

数据库设计分为六个阶段：

```
需求分析 → 概念设计 → 逻辑设计 → 物理设计 → 数据库实施 → 运行与维护
```

---

## 二、需求分析阶段

### 2.1 需求分析的任务

**目的**：
- 通过详细调查现实世界要处理的对象
- 充分了解原系统工作概况
- 明确用户各种需求
- 确定新系统的功能

**重要性**：
- 需求分析是设计数据库的起点
- 结果是否准确将直接影响后面各个阶段的设计

### 2.2 需求分析的步骤

1. **调查分析用户活动**
   - 调查组织机构情况
   - 调查各部门的业务活动情况

2. **收集和分析需求数据，确定系统边界**
   - 信息需求
   - 处理需求
   - 安全性和完整性需求

3. **编写系统需求分析报告**
   - 数据流图
   - 功能模块图
   - 数据字典

### 2.3 需求分析的重点

#### 1. 信息要求
- 用户需要从数据库中获得信息的内容与性质
- 导出数据要求：数据库中需要存储哪些数据

#### 2. 处理要求
- 对处理功能的要求
- 对处理响应时间的要求
- 对处理方式的要求（批处理/联机处理）

#### 3. 安全性与完整性要求

### 2.4 需求分析的难点

**难点**：确定用户的最终需求

**原因**：
- 用户缺少计算机知识，无法准确表达需求
- 设计人员缺少用户专业知识，不易理解真正需求
- 新技术的出现会使用户需求发生变化

**解决方法**：
- 设计人员必须采用有效的方法
- 与用户不断深入地进行交流
- 逐步确定用户的实际需求

### 2.5 数据字典

**定义**：各类数据描述的集合

**用途**：
- 说明系统中数据的静态组成结构
- 数据库系统中各类数据属性的清单
- 在数据库设计中占有很重要的地位

**内容**：
1. **数据项**：不可再分的数据单位
2. **数据结构**：数据之间的组合关系
3. **数据流**：数据结构在系统内传输的路径
4. **数据存储**：数据结构停留或保存的地方
5. **处理过程**：处理逻辑描述

---

## 三、概念设计阶段

### 3.1 概念设计的任务

**目的**：
- 将需求分析得到的用户需求抽象为信息结构
- 即概念模型（E-R模型）

**概念模型的特点**：
- ✅ 能真实、充分地反映现实世界
- ✅ 易于理解
- ✅ 易于更改
- ✅ 易于向各种数据模型转换

**描述工具**：实体（Entity）-联系(Relation)模型（E-R模型）

### 3.2 E-R模型基本概念

#### 1. 实体（Entity）
- 现实世界中客观存在并可相互区别的事物

#### 2. 属性（Attribute）
- 实体所具有的某一特性

#### 3. 码（Key）
- 唯一表示实体的属性集

#### 4. 域（Domain）
- 属性的取值范围

#### 5. 实体集
- 具有相同特征的实体集合

#### 6. 实体型
- 用实体名及其属性名集合来抽象和刻画同类实体
- 例：员工（员工编号、姓名、部门、性别、年龄、职称）

#### 7. 联系（Relationship）

**实体内部的联系**：
- 组成实体的各属性之间的联系

**实体之间的联系**：
- **1对1联系（1:1）**：每个实体至多与另一个实体集的一个实体对应
  - 例：部门 - 负责人

- **1对多联系（1:n）**：一个实体对应多个实体，反之至多一个
  - 例：部门 - 员工

- **多对多联系（m:n）**：双方都可对应多个实体
  - 例：学生 - 课程

### 3.3 E-R图设计

**图形表示法**：
- 📦 **矩形**：表示实体
- ⬭ **椭圆形**：表示属性（键值属性加下划线）
- ◇ **菱形**：表示联系
- —— **连线**：连接实体与属性/联系，标明种类
- **虚边矩形/虚边菱形**：表示弱实体及其联系

**设计步骤**：
1. 确定实体类型及实体名
2. 确定联系类型及联系名
3. 连接实体类型和联系类型，组合成E-R图
4. 确定实体类型和联系类型的属性
5. 确定实体类型的码

### 3.4 概念设计的步骤与方法

#### 设计方法

**1. 自顶向下**：
- 首先定义全局概念结构的框架
- 然后逐步细化

**2. 自底向上**：
- 首先定义各局部应用的概念结构
- 然后将它们集成起来
- 得到全局概念结构

**3. 逐步扩张**：
- 首先定义最重要的核心概念结构
- 然后向外扩充
- 以滚雪球的方式逐步生成其他概念结构

**4. 混合策略（常用）**：
- 自顶向下地进行需求分析
- 自底向上地设计概念结构

#### 自底向上设计步骤

**第1步：抽象数据并设计局部视图**
- 选择局部E-R图的描述范围
- 画出局部E-R图

**第2步：集成局部视图，得到全局概念结构**

**集成方式**：
1. **多元集成法**：局部视图比较简单时
2. **二元集成法**：每次集成一个新的局部视图

**集成步骤**：
1. **合并**：解决各局部E-R图之间的冲突
2. **优化**：消除不必要的冗余

### 3.5 集成局部E-R图的冲突

#### 1. 属性冲突
- **属性域冲突**：属性值的类型、取值范围不同
- **属性取值单位冲突**：单位不一致
- **解决方法**：通过讨论、协商解决

#### 2. 命名冲突
- **同名异义**：不同意义的对象有相同名字
- **异名同义**：同一意义的对象有不同名字
- **解决方法**：统一命名规范

#### 3. 结构冲突

**同一对象的不同抽象**：
- 例：在一个应用中是实体，在另一个应用中是属性

**解决准则**：
- 属性不能再具有需要描述的性质
- 属性不能与其他实体具有联系
- 为简化E-R图，凡能够作为属性的应尽量作为属性

**同一实体的属性不完全相同**：
- 解决方法：取属性的并集，适当调整属性次序

**实体间联系类型不同**：
- 根据应用语义对实体联系的类型进行综合或调整

### 3.6 消除冗余

**冗余的数据**：可由基本数据导出的数据

**冗余的联系**：可由其他联系导出的联系

**消除方法**：
- 以数据字典和数据流图为依据
- 根据数据项之间逻辑关系的说明来消除冗余

---

## 四、逻辑设计阶段

### 4.1 逻辑设计的任务

**目的**：
- 将概念结构（E-R图）转化为相应的数据模型
- 即DBMS支持的数据模型

### 4.2 E-R图转化为关系数据模型

#### 转换原则

**1. 一个实体型转换为一个关系模式**
- **关系的属性**：实体型的属性
- **关系的码**：实体型的码

**示例**：
```
学院（学院编号，学院名）
专业（专业号，专业名）
班级（班级号，班级名）
学生（学号，姓名，性别，出生日期）
课程（课程号，课程名）
教师（工号，姓名，性别，职称）
```

**2. 一个1:1联系的转换**

两种方式：
- **转换为独立关系模式**：
  - 属性：与该联系相连的各实体的码以及联系本身的属性
  - 码：每个实体的码均是该关系的候选码

- **与任意一端对应的关系模式合并**：
  - 在该关系模式中加入对应关系的码和联系本身的属性
  - 码：不变

**示例**：
```
负责（学院编号，工号）  // 独立关系模式
或
系（学院编号，系名，工号）  // 与系合并
或
负责人（工号，姓名，性别，学院编号）  // 与负责人合并
```

**选择原则**：
- 以尽量减少连接操作为目标
- 根据具体应用情况决定

**3. 一个1:n联系的转换**

两种方式：
- **转换为独立关系模式**：
  - 属性：与该联系相连的各实体的码以及联系本身的属性
  - 码：n端实体的码

- **与n端对应的关系模式合并**：
  - 在n端关系模式中加入1端关系的码和联系本身的属性
  - 码：不变

**示例**：
```
开设（学院编号，专业号）  // 独立关系模式
或
专业（专业号，专业名，学院编号）  // 与n端（专业）合并
```

**4. 一个m:n联系转换为一个关系模式**
- **属性**：与该联系相连的各实体的码以及联系本身的属性
- **码**：各实体码的组合

**示例**：
```
选修（学号，课程号，成绩）
```

**5. 三个或以上实体间的多元联系**
- **属性**：与该多元联系相连的各实体的码以及联系本身的属性
- **码**：各实体码的组合

**示例**：
```
供应（供应商号，项目号，零件号，数量）
```

**6. 具有相同码的关系模式可合并**
- **目的**：减少系统中的关系个数
- **方法**：将属性合并到一个关系中，去掉同义属性

**示例**：
```
开设（系号，专业号）
专业（专业号，专业名）
  ↓ 合并
专业（专业号，专业名，系号）
```

### 4.3 关系模式优化

#### 为什么要优化？
- 数据库逻辑设计的结果不是唯一的
- 需要适当修改、调整数据模型的结构
- 以进一步提高数据库应用系统的性能
- 关系数据模型的优化通常以规范化理论为指导

#### 优化步骤

**1. 确定数据依赖**
- 写出每个关系模式内部各属性之间的数据依赖
- 写出不同关系模式属性之间的数据依赖

**2. 极小化处理**
- 对各个关系模式之间的数据依赖进行极小化处理
- 消除冗余的联系

**3. 范式分析**
- 对关系模式逐一进行分析
- 考查是否存在部分函数依赖、传递函数依赖、多值依赖等
- 确定各关系模式分别属于第几范式

**4. 模式分解**
- 按照需求分析阶段得到的各种应用对数据处理的要求
- 分析对于应用环境这些模式是否合适
- 确定是否要对它们进行合并或分解

**5. 进一步分解**
- **水平分解**：把关系的元组分为若干子集合
  - 适用范围：满足"80/20原则"的应用
  - 例：活跃用户和非活跃用户

- **垂直分解**：把关系模式的属性分解为若干子集合
  - 原则：保持无损连接性和保持函数依赖
  - 优点：减少数据传递量，提高查询速度
  - 例：常查询字段和非常查询字段

#### 注意事项
- ⚠️ 并不是规范化程度越高的关系就越优
- ⚠️ 需要权衡响应时间和潜在问题两者的利弊
- ⚠️ 如果只是查询操作，低范式也许是最好的
- ⚠️ 可以把冗余数据定义在视图中

### 4.4 设计用户子模式（外模式）

**目的**：
- 使用更符合用户习惯的别名
- 满足系统对安全性的要求
- 简化用户对系统的使用

**三个方面**：

**1. 使用符合用户习惯的别名**
- 例：将"工号"重定义为"教师编号"

**2. 定义不同级别的外模式**
- 例：教务管理系统只能查询部分学生信息
```sql
CREATE VIEW 学生_教务系统（学号、姓名、性别、班级、入学年份）
AS SELECT 学号、姓名、性别、班级、入学年份 FROM 学生
```

**3. 简化复杂查询**
- 将复杂查询定义为视图

---

## 五、物理设计阶段

### 5.1 物理设计的概念

**物理结构**：
- 数据库在物理设备上的存储结构与存取方法

**物理设计**：
- 为逻辑数据模型选取一个最适合应用要求的物理结构的过程

### 5.2 准备工作

1. **充分了解应用环境**
   - 详细分析要运行的事务
   - 获得选择物理设计所需参数
   - 特别是应用的处理频率和响应时间要求

2. **充分了解RDBMS的内部特征**
   - 系统提供的存取方法和存储结构
   - 有哪些存储结构（行存储、列存储、聚簇存储）
   - 有哪些索引（B+树索引、HASH索引等）
   - 如何选择和建立

3. **熟悉外存设备的特性**
   - 分块原则
   - 块因子大小的规定
   - 设备的I/O特性

**注意**：
- 不同的DBMS产品，物理环境、存取方法和存储结构有很大差别
- 没有通用的物理设计方法
- 只能给出一般的设计内容和原则

### 5.3 物理设计的步骤

#### 1. 确定数据库的物理结构

**确定数据的存储结构**：
- 考虑因素：存取时间、存储空间利用率和维护代价

**设计合适的存取路径**：
- 主要指确定如何建立索引

**确定数据的存放位置**：
- 将易变部分与稳定部分分开存放
- 将存取频率高与低的部分分开存放
- 以提高系统性能

**确定系统配置**：
- DBMS产品提供的系统配置变量
- 存储分配参数

#### 2. 评价物理结构

**评价内容**：
- 时间效率
- 空间效率
- 维护代价
- 各种用户需求

**评价方法**：
- 定量估算各种方案的存储空间、存取时间和维护代价
- 对估算结果进行权衡、比较
- 选择一个较优的合理的物理结构
- 如果不符合用户需求，则需要修改设计

**注意**：
- 数据库的物理设计不是一劳永逸的
- 要根据应用的变化，及时收集设计信息
- 调整数据库的物理结构

---

## 六、数据库实施阶段

### 6.1 数据库实施的工作内容

1. **用DDL定义数据库结构**
2. **组织数据入库**
3. **编制与调试应用程序**
4. **数据库试运行**

### 6.2 定义数据库结构

**步骤**：
```sql
-- 1. 创建表
CREATE TABLE stocks(
   mat_no CHAR(8) PRIMARY KEY,
   ...CHECK...
);

-- 2. 创建视图
CREATE VIEW view1(...);

-- 3. 创建索引
CREATE INDEX ...
```

### 6.3 数据装载（ETL）

**方法**：
- **人工方法**：适用于小型系统
- **计算机辅助数据入库**：适用于中大型系统

### 6.4 应用程序的设计、调试

**要点**：
- 数据库应用程序的设计应与数据库设计同时进行
- 当数据库结构建立好后，开始编制与调试应用程序
- 调试应用程序时可先使用模拟数据

### 6.5 数据库试运行

**主要工作**：
1. **功能测试**：
   - 实际运行应用程序
   - 执行对数据库的各种操作
   - 测试应用程序的各种功能

2. **性能测试**：
   - 测试系统的性能指标
   - 分析是否符合设计目标
   - 如果不符合，需要返回物理设计阶段调整
   - 甚至需要返回逻辑设计阶段

### 6.6 注意事项

**数据分批分期入库**：
- 先输入小批量数据做调试
- 待试运行基本合格后，再大批量输入

**首先调试恢复功能**：
- 做好数据库的转储和恢复工作
- 系统还不稳定，硬、软件故障随时可能发生
- 操作人员对新系统不熟悉，误操作不可避免

**整理文档**：
- 随时记录问题的解决方案
- 整理成文档，以备运行维护和改进时参考
- 编写测试报告、技术说明书和使用说明书
- 完整的文档是应用系统的重要组成部分

---

## 七、数据库运行与维护阶段

### 7.1 数据库的转储和恢复

**重要性**：系统正式运行后最重要的维护工作之一

**DBA的职责**：
- 针对不同应用要求制定不同的转储计划
- 定期对数据库和日志文件进行备份
- 一旦发生介质故障，利用备份尽快恢复数据库

### 7.2 数据库的安全性、完整性控制

**安全性控制**：
- DBA根据用户实际需要授予不同的操作权限
- 在运行过程中，根据环境变化修改原有的安全性控制

**完整性控制**：
- 由于应用环境的变化，完整性约束条件也会变化
- DBA需要不断修正，以满足用户要求

### 7.3 数据库性能的监督、分析和改进

**DBA的工作**：
- 监督系统运行
- 对监测数据进行分析
- 找出改进系统性能的方法

**具体步骤**：
1. 利用监测工具获取系统运行过程中的性能参数值
2. 通过分析这些数据，判断系统是否处于最佳运行状态
3. 如果不是，则通过调整某些参数来改进数据库性能

### 7.4 数据库的重组织和重构造

#### 1. 数据库的重组织

**重组织形式**：
- 全部重组织
- 部分重组织（只对频繁增、删的表进行重组织）

**重组织工作**：
- 按原设计要求重新安排存储位置
- 回收垃圾
- 减少指针链
- 以提高系统性能

**实质**：不会修改原设计的逻辑和物理结构

#### 2. 数据库的重构造

**重构造工作**：
- 根据新环境调整数据库的模式和内模式
- 例如：
  - 增加新的数据项
  - 改变数据项的类型
  - 改变数据库的容量
  - 增加或删除索引
  - 修改完整性约束条件

**实质**：部分修改数据库的模式和内模式

**重构造局限**：
- 部分重构造
- 若变化太大，无法通过重构数据库来满足新的需求
- 或重构数据库的代价太大
- 则表明现有数据库应用系统的生命周期已经结束
- 应该重新设计新的数据库应用系统

---

## 八、考试重点总结

### 8.1 核心概念（必考）

1. ✅ 数据库设计的六个阶段及各阶段任务
2. ✅ E-R模型的基本概念（实体、属性、联系）
3. ✅ E-R图的绘制方法
4. ✅ 1:1、1:n、m:n三种联系类型
5. ✅ E-R图转换为关系模型的规则
6. ✅ 数据字典的内容
7. ✅ 物理设计与逻辑设计的区别

### 8.2 常考题型

#### 概念题
1. 数据库设计的六个阶段是什么？各阶段的任务是什么？
2. 什么是概念模型？为什么要使用概念模型？
3. 什么是E-R模型？E-R模型的基本元素有哪些？
4. 实体间的联系有哪几种类型？
5. 什么是数据字典？数据字典包含哪些内容？
6. 什么是物理设计？物理设计要做哪些工作？

#### 设计题
1. 根据需求描述绘制E-R图
2. 将E-R图转换为关系模式
3. 对关系模式进行规范化
4. 设计数据字典

#### 综合应用题
1. 给定一个应用场景，完成从需求分析到逻辑设计的全过程
2. 分析给定的E-R图，找出其中的问题并改