# 【复习精编】第9章 - 数据库安全

> 数据库期末复习 - 核心知识点整理

---

## 一、数据库安全概述

### 1.1 安全性的定义

**数据库安全性**：保护数据库以防止不合法使用所造成的数据泄露、更改或破坏。

### 1.2 数据库的不安全因素

**非授权用户对数据库的恶意存取和破坏**：
- 一些黑客和犯罪分子在用户存取数据库时窃取数据
- 破坏数据完整性
- 盗用用户账号，甚至破坏整个系统

### 1.3 安全标准简介

**TCSEC/TDI标准**（Trusted Computer System Evaluation Criteria）：
- **D级**：最小保护级
- **C级**：自主保护级
  - C1：自主安全保护
  - C2：受控的存取保护
- **B级**：强制保护级
  - B1：标记的安全保护
  - B2：结构化保护
  - B3：安全域
- **A级**：验证保护级
  - A1：验证设计

---

## 二、数据库安全性控制

### 2.1 用户身份鉴别

#### 定义
系统提供的最外层安全保护措施，是数据库管理系统提供的第一道防线。

#### 方法

**1. 静态口令鉴别**
- 每个用户拥有账号和口令
- 系统核对账号和口令的正确性
- 缺点：容易被攻击

**2. 动态口令鉴别**
- 口令是动态变化的，每次鉴别时均需使用动态产生的新口令登录
- 如短信验证码
- 特点：即使被窃听，也不能重复使用

**3. 生物特征鉴别**
- 指纹
- 虹膜
- 掌纹等

**4. 智能卡鉴别**
- 使用不可复制的硬件
- 与个人身份识别码结合

### 2.2 存取控制

#### 定义
对用户存取数据的权限进行控制，确保只有授权用户才能访问数据库中的数据。

#### 存取控制机制组成

**自主存取控制（DAC - Discretionary Access Control）**：
- 用户对不同的数据对象有不同的存取权限
- 不同的用户对同一对象也有不同的权限
- 用户还可将其拥有的存取权限转授给其他用户

**强制存取控制（MAC - Mandatory Access Control）**：
- 每一个数据对象被标以一定的密级
- 每一个用户也被授予某一个级别的许可证
- 对于任意一个对象，只有具有合法许可证的用户才可以存取

---

## 三、自主存取控制方法

### 3.1 授权与收回

#### SQL的GRANT语句

**语法格式**：
```sql
GRANT <权限>[,<权限>]...
[ON <对象类型> <对象名>[,<对象类型> <对象名>]...]
TO <用户>[,<用户>]...
[WITH GRANT OPTION];
```

**权限类型**：
- SELECT：查询
- INSERT：插入
- UPDATE：修改
- DELETE：删除
- ALL PRIVILEGES：所有权限

**对象类型**：
- 表
- 视图
- 数据库等

**WITH GRANT OPTION**：
- 获得某种权限的用户可以把这种权限再授予其他用户
- 如果没有指定，则获得权限的用户不能传播该权限

#### 示例

**例1：授予用户U1对学生表Student的查询权限**
```sql
GRANT SELECT 
ON TABLE Student 
TO U1;
```

**例2：授予用户U2和U3对学生表Student的插入权限**
```sql
GRANT INSERT 
ON TABLE Student 
TO U2, U3;
```

**例3：授予用户U4对Student表的所有操作权限，并允许其转授**
```sql
GRANT ALL PRIVILEGES 
ON TABLE Student 
TO U4 
WITH GRANT OPTION;
```

**例4：授予所有用户对Student表的查询权限**
```sql
GRANT SELECT 
ON TABLE Student 
TO PUBLIC;
```

**例5：授予用户U5对Student表的修改学号(Sno)的权限**
```sql
GRANT UPDATE(Sno) 
ON TABLE Student 
TO U5;
```

#### SQL的REVOKE语句

**语法格式**：
```sql
REVOKE <权限>[,<权限>]...
[ON <对象类型> <对象名>[,<对象类型> <对象名>]...]
FROM <用户>[,<用户>]...
[CASCADE | RESTRICT];
```

**CASCADE（级联）**：
- 如果指定了CASCADE，则该用户用GRANT授予其他用户的权限也会被收回

**RESTRICT（限制）**：
- 如果存在级联授权，REVOKE语句将返回错误

#### 示例

**例1：收回用户U4对Student表的所有权限**
```sql
REVOKE ALL PRIVILEGES 
ON TABLE Student 
FROM U4;
```

**例2：收回所有用户对Student表的查询权限**
```sql
REVOKE SELECT 
ON TABLE Student 
FROM PUBLIC;
```

**例3：收回用户U5对Student表修改学号的权限**
```sql
REVOKE UPDATE(Sno) 
ON TABLE Student 
FROM U5;
```

### 3.2 数据库角色

#### 什么是角色

**角色（Role）**：被命名的一组与数据库操作相关的权限，是权限的集合。

**作用**：
- 简化授权过程
- 方便权限管理

#### 角色的创建

**语法**：
```sql
CREATE ROLE <角色名>;
```

**例**：
```sql
CREATE ROLE R1;
```

#### 角色的授权

**给角色授权**：
```sql
GRANT <权限>[,<权限>]...
ON <对象类型> <对象名>
TO <角色>[,<角色>]...;
```

**例：授予角色R1对Student表的查询、插入、更新、删除权限**
```sql
GRANT SELECT, INSERT, UPDATE, DELETE 
ON TABLE Student 
TO R1;
```

#### 将角色授予用户

**语法**：
```sql
GRANT <角色>[,<角色>]...
TO <用户>[,<用户>]...
[WITH ADMIN OPTION];
```

**WITH ADMIN OPTION**：
- 指定后，获得角色的用户可以将该角色再授予其他用户或角色

**例1：将角色R1授予用户张三和李四**
```sql
GRANT R1 
TO 张三, 李四;
```

**例2：将角色R1授予用户王五，并允许其转授**
```sql
GRANT R1 
TO 王五 
WITH ADMIN OPTION;
```

#### 角色权限的收回

**语法**：
```sql
REVOKE <权限>[,<权限>]...
ON <对象类型> <对象名>
FROM <角色>[,<角色>]...;
```

**例**：
```sql
REVOKE SELECT 
ON TABLE Student 
FROM R1;
```

---

## 四、强制存取控制方法

### 4.1 基本概念

#### 主体和客体

**主体**：系统中的活动实体（用户、进程等）
- 被赋予标记（Label），包含两部分：
  - **敏感度级别**
  - **类别集合**

**客体**：系统中的被动实体（文件、表、记录等）
- 也被赋予标记，表明该客体的敏感程度

#### 敏感度级别

常见的敏感度级别划分（由低到高）：
1. **TS（Top Secret）**：绝密
2. **S（Secret）**：机密
3. **C（Confidential）**：秘密
4. **P（Public）**：公开

### 4.2 强制存取控制规则

**规则1（向下读）**：
- 仅当主体的许可证级别 **≥** 客体的密级时，该主体才能**读**该客体

**规则2（向上写）**：
- 仅当主体的许可证级别 **≤** 客体的密级时，该主体才能**写**该客体

**目的**：
- 防止信息从高密级流向低密级
- 确保敏感信息不会被泄露

### 4.3 DAC与MAC的结合

**实际DBMS中的做法**：
1. 首先进行**自主存取控制检查（DAC）**
2. 通过后，再进行**强制存取控制检查（MAC）**
3. 只有通过了DAC和MAC检查，用户才能存取数据

**特点**：
- MAC相对固定
- DAC较为灵活
- 两者结合提供更强的安全性

---

## 五、视图机制

### 5.1 视图的安全作用

**视图机制**：为数据库的安全性提供了一定程度的支持。

**作用**：
- 把要保密的数据对无权存取的用户隐藏起来
- 对不同的用户定义不同的视图
- 提供数据的逻辑独立性

### 5.2 视图的使用

**例：建立计算机系学生的视图**
```sql
CREATE VIEW CS_Student
AS
SELECT *
FROM Student
WHERE Sdept = 'CS';
```

**授权示例**：
```sql
GRANT SELECT 
ON CS_Student 
TO 王平;
```

**说明**：
- 王平只能查询计算机系的学生信息
- 其他系的学生信息对王平是隐藏的

---

## 六、审计（Audit）

### 6.1 审计的概念

**审计**：启用一个专用的审计日志，将用户对数据库的所有操作记录在审计日志中。

**作用**：
- DBA可以利用审计跟踪的信息，重现导致数据库现有状况的一系列事件
- 找出非法存取数据的人、时间和内容等

### 6.2 审计的功能

**审计内容包括**：
- 用户登录和退出系统
- 对数据库对象的操作（查询、插入、更新、删除等）
- 执行的SQL语句
- 操作的时间
- 操作是否成功

### 6.3 审计的分类

**按审计级别分类**：

**1. 语句级审计（Statement Audit）**
- 审计某类SQL语句的执行情况
- 例如：审计所有的CREATE TABLE语句

**2. 对象级审计（Object Audit）**
- 审计对特定对象的操作
- 例如：审计对Student表的所有操作

**按审计方式分类**：

**1. 用户级审计**
- 针对特定用户的所有操作进行审计

**2. 系统级审计**
- 对所有用户的操作进行审计

### 6.4 AUDIT和NOAUDIT语句

#### AUDIT语句（启动审计功能）

**语法**：
```sql
AUDIT <审计内容>
ON <对象>
BY <用户>
WHENEVER [NOT] SUCCESSFUL;
```

**参数说明**：
- **审计内容**：要审计的操作类型（如SELECT、INSERT、UPDATE、DELETE、ALL等）
- **WHENEVER SUCCESSFUL**：只审计成功的操作
- **WHENEVER NOT SUCCESSFUL**：只审计失败的操作

**例1：对Student表的所有成功操作进行审计**
```sql
AUDIT ALL 
ON Student 
WHENEVER SUCCESSFUL;
```

**例2：审计修改SC表结构的语句**
```sql
AUDIT ALTER 
ON SC;
```

#### NOAUDIT语句（取消审计功能）

**语法**：
```sql
NOAUDIT <审计内容>
ON <对象>
BY <用户>;
```

**例：取消对Student表的审计**
```sql
NOAUDIT ALL 
ON Student;
```

---

## 七、数据加密

### 7.1 数据加密的概念

**数据加密**：防止数据库中数据在存储和传输中失密的有效手段。

**加密过程**：
- 原始数据（明文）→ 加密算法 → 加密数据（密文）

**解密过程**：
- 加密数据（密文）→ 解密算法 → 原始数据（明文）

### 7.2 加密的分类

**按加密位置分类**：

**1. 存储加密**
- 对存储在磁盘上的数据进行加密
- 防止数据被非法读取

**2. 传输加密**
- 对网络传输的数据进行加密
- 防止数据在传输过程中被窃取

### 7.3 加密方法

**1. 替换方法**
- 用密文字符替换明文字符
- 例如：凯撒密码

**2. 置换方法**
- 将明文中的字符按某种规则重新排列

**3. 混合方法**
- 结合替换和置换

### 7.4 加密算法

**对称加密算法**：
- 加密和解密使用相同的密钥
- 例如：DES、AES
- 特点：速度快，适合大量数据加密

**非对称加密算法**：
- 使用公钥加密，私钥解密
- 例如：RSA
- 特点：安全性高，但速度较慢

---

## 八、其他安全性保护

### 8.1 推理控制

**问题**：用户通过多次查询可能推理出保密数据。

**解决方法**：
- 限制查询结果的精度
- 对查询结果添加噪声
- 限制查询次数

### 8.2 隐蔽信道

**隐蔽信道**：通过非正常途径传递信息的通道。

**防范措施**：
- 监控系统资源使用情况
- 限制信息流动

### 8.3 数据隐私保护

**数据隐私**：保护个人敏感信息不被非法获取和使用。

**措施**：
- 数据脱敏
- 匿名化处理
- 差分隐私

---

## 九、MySQL安全性实现

### 9.1 MySQL权限系统

**MySQL权限表**（存储在mysql数据库中）：
- **user表**：存储用户账号和全局权限
- **db表**：存储数据库级别的权限
- **tables_priv表**：存储表级别的权限
- **columns_priv表**：存储列级别的权限

### 9.2 MySQL用户管理

**创建用户**：
```sql
CREATE USER '用户名'@'主机名' IDENTIFIED BY '密码';
```

**删除用户**：
```sql
DROP USER '用户名'@'主机名';
```

**修改密码**：
```sql
ALTER USER '用户名'@'主机名' IDENTIFIED BY '新密码';
```

**例**：
```sql
-- 创建用户
CREATE USER 'zhangsan'@'localhost' IDENTIFIED BY '123456';

-- 授权
GRANT SELECT, INSERT ON testdb.* TO 'zhangsan'@'localhost';

-- 刷新权限
FLUSH PRIVILEGES;

-- 查看权限
SHOW GRANTS FOR 'zhangsan'@'localhost';
```

---

## 十、关键考点总结

### 10.1 核心概念
- 数据库安全性的定义和重要性
- 用户身份鉴别方法
- 存取控制机制（DAC和MAC）
- 角色的概念和使用

### 10.2 SQL语句
- **GRANT**：授予权限
- **REVOKE**：收回权限
- **CREATE ROLE**：创建角色
- **AUDIT / NOAUDIT**：审计控制

### 10.3 重要知识点
- WITH GRANT OPTION的作用
- WITH ADMIN OPTION的作用
- CASCADE和RESTRICT的区别
- 强制存取控制的规则（向下读、向上写）
- 审计的分类和作用
- 数据加密的方法

### 10.4 实践应用
- 如何为用户授权和收回权限
- 如何创建和使用角色
- 如何启用审计功能
- 视图在安全性中的作用

---

**复习建议**：
1. 重点掌握GRANT和REVOKE语句的语法和使用
2. 理解角色的概念和优势
3. 区分自主存取控制和强制存取控制
4. 掌握审计的基本概念和AUDIT语句
5. 了解数据加密的基本原理
6. 能够根据实际场景设计合理的权限方案

