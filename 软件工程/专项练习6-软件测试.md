# 专项练习6：软件测试

## 知识点总结

### 1. 黑盒测试方法

黑盒测试关注输入和输出，不考虑内部结构。

#### (1) 等价类划分（Equivalence Partitioning）

将输入域划分为若干等价类，从每个等价类中选取代表性测试用例。

**等价类类型：**
- **有效等价类**：符合要求的输入
- **无效等价类**：不符合要求的输入

**划分原则：**
1. 范围条件：一个有效等价类 + 两个无效等价类（低于、高于）
2. 数值个数：一个有效等价类（=n） + 两个无效等价类（<n、>n）
3. 集合条件：每个值一个有效等价类 + 一个无效等价类
4. 布尔条件：真、假各一个等价类

**示例：年龄输入（18-60岁）**
- 有效等价类：18 ≤ 年龄 ≤ 60
- 无效等价类1：年龄 < 18
- 无效等价类2：年龄 > 60

---

#### (2) 边界值分析（Boundary Value Analysis）

边界值是错误最容易发生的地方，测试边界及其附近的值。

**选取原则：**
- 上点：边界值本身
- 离点：边界值±1
- 内点：边界内部值（可选）

**示例：年龄输入（18-60岁）**
- 测试值：17, 18, 19, 59, 60, 61

---

#### (3) 判定表（Decision Table）

用于测试多条件组合的逻辑关系。

**结构：**
```
┌──────────────┬────┬────┬────┬────┐
│  条件         │ R1 │ R2 │ R3 │ R4 │
├──────────────┼────┼────┼────┼────┤
│ 条件1         │ T  │ T  │ F  │ F  │
│ 条件2         │ T  │ F  │ T  │ F  │
├──────────────┼────┼────┼────┼────┤
│ 动作1         │ X  │    │    │    │
│ 动作2         │    │ X  │ X  │    │
│ 动作3         │    │    │    │ X  │
└──────────────┴────┴────┴────┴────┘
```

**步骤：**
1. 列出所有条件和动作
2. 列举所有条件组合（2^n种）
3. 填写每种组合对应的动作
4. 简化：合并相同结果的列

---

### 2. 白盒测试方法

白盒测试关注程序内部结构和逻辑。

#### (1) 控制流图（Control Flow Graph）

**基本元素：**
- **节点**：表示语句或语句块
- **边**：表示控制流转移
- **判定节点**：有多个出口的节点（if、while等）

**环路复杂度（Cyclomatic Complexity）：**
```
V(G) = E - N + 2
V(G) = P + 1
```
- E：边数
- N：节点数
- P：判定节点数

**含义：** V(G)表示程序的独立路径数量，也是基本测试用例的最小数量。

---

#### (2) 语句覆盖（Statement Coverage）

**定义：** 每条语句至少执行一次。

**覆盖率 = 被执行的语句数 / 总语句数 × 100%**

**优点：** 简单、容易实现
**缺点：** 覆盖率低，可能遗漏逻辑错误

---

#### (3) 判定覆盖/分支覆盖（Decision/Branch Coverage）

**定义：** 每个判定的真假分支至少执行一次。

**覆盖率 = 被执行的分支数 / 总分支数 × 100%**

**优点：** 比语句覆盖强
**缺点：** 未考虑判定内部的组合条件

---

#### (4) 条件覆盖（Condition Coverage）

**定义：** 每个条件的真假值至少出现一次。

**示例：** 
```
if (A > 0 && B < 10)
```
需要测试：
- A>0为真，A>0为假
- B<10为真，B<10为假

**注意：** 条件覆盖不一定包含判定覆盖。

---

#### (5) 条件/判定覆盖（Condition/Decision Coverage）

**定义：** 同时满足条件覆盖和判定覆盖。

---

#### (6) 路径覆盖（Path Coverage）

**定义：** 覆盖程序中所有可能的执行路径。

**优点：** 覆盖最彻底
**缺点：** 路径数量可能非常大（指数级）

---

### 3. 覆盖强度排序

```
语句覆盖 < 判定覆盖 < 条件覆盖 < 条件/判定覆盖 < 路径覆盖
```

---

## 练习题目

### 题目：在线选课系统测试（15分）

#### 背景描述

某大学开发了在线选课系统，其中"选课验证"模块的逻辑如下：

**输入：**
- 学生学分：credits（整数）
- 已选课程数：courseCount（整数）
- 课程容量剩余：capacity（整数）

**业务规则：**
1. 学生学分必须在0-200之间
2. 已选课程数必须在0-10之间
3. 课程容量剩余必须大于0
4. 只有满足以下条件才能选课成功：
   - 学分 ≥ 60 **且** 已选课程数 < 8 **且** 课程容量 > 0
5. 否则选课失败

**伪代码：**
```
function validateCourseSelection(credits, courseCount, capacity):
    if (credits < 0 or credits > 200):          // 条件A
        return "学分无效"
    if (courseCount < 0 or courseCount > 10):   // 条件B
        return "课程数无效"
    if (capacity <= 0):                         // 条件C
        return "课程已满"
    if (credits >= 60 and courseCount < 8 and capacity > 0):  // 条件D
        return "选课成功"
    else:
        return "选课失败"
```

---

#### 问题

**第一部分：黑盒测试（9分）**

1. 使用**等价类划分**方法，设计测试用例（4分）
   - 列出所有有效等价类和无效等价类（2分）
   - 设计至少5个测试用例，覆盖所有等价类（2分）

2. 使用**边界值分析**方法，针对`credits`参数设计测试用例（3分）
   - 列出所有边界值（1分）
   - 设计完整的测试用例表（2分）

3. 针对条件D `(credits >= 60 and courseCount < 8 and capacity > 0)`，使用**判定表**设计测试用例（2分）

**第二部分：白盒测试（6分）**

4. 绘制上述伪代码的**控制流图**（2分）

5. 计算控制流图的**环路复杂度**（1分）

6. 设计测试用例，达到**语句覆盖**和**判定覆盖**（3分）
   - 语句覆盖：至少几个测试用例？（1分）
   - 判定覆盖：至少几个测试用例？（1分）
   - 设计具体的测试用例（1分）

---

## 标准答案

### 第一部分：黑盒测试

#### 1. 等价类划分（4分）

**等价类列表：**

| 输入参数 | 有效等价类 | 无效等价类 |
|---------|-----------|-----------|
| credits | E1: 0 ≤ credits ≤ 200 | E2: credits < 0<br>E3: credits > 200 |
| courseCount | E4: 0 ≤ courseCount ≤ 10 | E5: courseCount < 0<br>E6: courseCount > 10 |
| capacity | E7: capacity > 0 | E8: capacity ≤ 0 |
| 业务规则 | E9: credits≥60 且 courseCount<8 且 capacity>0 | E10: 不满足E9的条件 |

（列出等价类：2分）

**测试用例设计：**

| 用例ID | credits | courseCount | capacity | 覆盖等价类 | 预期结果 |
|-------|---------|-------------|----------|-----------|---------|
| TC1 | 100 | 5 | 10 | E1, E4, E7, E9 | 选课成功 |
| TC2 | -10 | 5 | 10 | E2 | 学分无效 |
| TC3 | 250 | 5 | 10 | E3 | 学分无效 |
| TC4 | 100 | -1 | 10 | E5 | 课程数无效 |
| TC5 | 100 | 15 | 10 | E6 | 课程数无效 |
| TC6 | 100 | 5 | 0 | E8 | 课程已满 |
| TC7 | 50 | 5 | 10 | E1, E4, E7, E10 | 选课失败（学分<60） |
| TC8 | 100 | 9 | 10 | E1, E4, E7, E10 | 选课失败（课程数≥8） |

（设计测试用例：2分，至少5个有代表性的用例）

---

#### 2. 边界值分析（3分）

**针对`credits`参数（0-200）：**

**边界值：**
- 下边界：0
- 下边界附近：-1, 1
- 上边界：200
- 上边界附近：199, 201
- 业务规则边界：60（影响选课逻辑）
- 业务规则边界附近：59, 61

（列出边界值：1分）

**测试用例表：**

| 用例ID | credits | courseCount | capacity | 预期结果 | 说明 |
|-------|---------|-------------|----------|---------|------|
| BV1 | -1 | 5 | 10 | 学分无效 | 下边界-1 |
| BV2 | 0 | 5 | 10 | 选课失败 | 下边界 |
| BV3 | 1 | 5 | 10 | 选课失败 | 下边界+1 |
| BV4 | 59 | 5 | 10 | 选课失败 | 业务边界-1 |
| BV5 | 60 | 5 | 10 | 选课成功 | 业务边界 |
| BV6 | 61 | 5 | 10 | 选课成功 | 业务边界+1 |
| BV7 | 199 | 5 | 10 | 选课成功 | 上边界-1 |
| BV8 | 200 | 5 | 10 | 选课成功 | 上边界 |
| BV9 | 201 | 5 | 10 | 学分无效 | 上边界+1 |

（设计完整测试用例表：2分）

---

#### 3. 判定表（2分）

**条件：** `credits >= 60 and courseCount < 8 and capacity > 0`

**判定表：**

| 规则 | R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 |
|------|----|----|----|----|----|----|----|----|
| **条件** |||||||||
| credits ≥ 60 | T | T | T | T | F | F | F | F |
| courseCount < 8 | T | T | F | F | T | T | F | F |
| capacity > 0 | T | F | T | F | T | F | T | F |
| **动作** |||||||||
| 选课成功 | ✓ |  |  |  |  |  |  |  |
| 选课失败（其他原因） |  | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

**注意：** 实际系统中，capacity≤0会先返回"课程已满"，所以R2、R4、R6、R8可能不会到达最后的判定。

**测试用例：**

| 规则 | credits | courseCount | capacity | 预期结果 |
|------|---------|-------------|----------|---------|
| R1 | 80 | 5 | 10 | 选课成功 |
| R2 | 80 | 5 | 0 | 课程已满 |
| R3 | 80 | 9 | 10 | 选课失败 |
| R5 | 50 | 5 | 10 | 选课失败 |

（判定表及测试用例：2分）

---

### 第二部分：白盒测试

#### 4. 控制流图（2分）

```mermaid
graph TD
    Start([开始]) --> N1[读取输入]
    N1 --> N2{credits<0 or<br>credits>200?}
    N2 -->|是| N3[返回"学分无效"]
    N2 -->|否| N4{courseCount<0 or<br>courseCount>10?}
    N4 -->|是| N5[返回"课程数无效"]
    N4 -->|否| N6{capacity<=0?}
    N6 -->|是| N7[返回"课程已满"]
    N6 -->|否| N8{credits>=60 and<br>courseCount<8 and<br>capacity>0?}
    N8 -->|是| N9[返回"选课成功"]
    N8 -->|否| N10[返回"选课失败"]
    N3 --> End([结束])
    N5 --> End
    N7 --> End
    N9 --> End
    N10 --> End
```

**节点说明：**
- N1：入口节点
- N2, N4, N6, N8：判定节点（4个）
- N3, N5, N7, N9, N10：处理节点
- End：出口节点

**评分标准：**
- 正确识别所有判定节点：1分
- 控制流转移正确：1分

---

#### 5. 环路复杂度（1分）

**方法一：使用判定节点数**
```
V(G) = P + 1
```
其中P为判定节点数 = 4（N2, N4, N6, N8）

```
V(G) = 4 + 1 = 5
```

**方法二：使用边数和节点数**
```
V(G) = E - N + 2
```
- 节点数N = 11（含Start和End）
- 边数E = 14

```
V(G) = 14 - 11 + 2 = 5
```

**答案：环路复杂度 = 5**（1分）

**含义：** 该程序有5条独立路径，至少需要5个测试用例才能覆盖所有路径。

---

#### 6. 语句覆盖和判定覆盖（3分）

**独立路径：**
1. Start → N1 → N2(T) → N3 → End（学分无效）
2. Start → N1 → N2(F) → N4(T) → N5 → End（课程数无效）
3. Start → N1 → N2(F) → N4(F) → N6(T) → N7 → End（课程已满）
4. Start → N1 → N2(F) → N4(F) → N6(F) → N8(T) → N9 → End（选课成功）
5. Start → N1 → N2(F) → N4(F) → N6(F) → N8(F) → N10 → End（选课失败）

---

**语句覆盖：**

**至少1个测试用例**（理论上），但实际需要至少**5个测试用例**才能覆盖所有返回语句。

（答案：至少5个，1分）

**测试用例示例：**

| 用例 | credits | courseCount | capacity | 覆盖路径 | 执行的语句 |
|------|---------|-------------|----------|---------|-----------|
| ST1 | -10 | 5 | 10 | 路径1 | N1, N2(T), N3 |
| ST2 | 100 | -1 | 10 | 路径2 | N1, N2(F), N4(T), N5 |
| ST3 | 100 | 5 | 0 | 路径3 | N1, N2(F), N4(F), N6(T), N7 |
| ST4 | 100 | 5 | 10 | 路径4 | N1, N2(F), N4(F), N6(F), N8(T), N9 |
| ST5 | 50 | 5 | 10 | 路径5 | N1, N2(F), N4(F), N6(F), N8(F), N10 |

**语句覆盖率：100%**

---

**判定覆盖：**

**至少5个测试用例**，因为有4个判定节点，每个判定有2个分支，共8个分支。

但由于：
- N2的false分支会进入N4
- N4的false分支会进入N6
- N6的false分支会进入N8

所以5个测试用例可以覆盖所有8个分支。

（答案：至少5个，1分）

**测试用例：**

使用上述ST1-ST5即可达到100%判定覆盖。

**分支覆盖情况：**

| 测试用例 | N2(T) | N2(F) | N4(T) | N4(F) | N6(T) | N6(F) | N8(T) | N8(F) |
|---------|-------|-------|-------|-------|-------|-------|-------|-------|
| ST1 | ✓ |  |  |  |  |  |  |  |
| ST2 |  | ✓ | ✓ |  |  |  |  |  |
| ST3 |  | ✓ |  | ✓ | ✓ |  |  |  |
| ST4 |  | ✓ |  | ✓ |  | ✓ | ✓ |  |
| ST5 |  | ✓ |  | ✓ |  | ✓ |  | ✓ |

**判定覆盖率：100%（8/8分支）**

（设计具体测试用例：1分）

---

## 解题技巧

### 1. 等价类划分技巧

**步骤：**
1. 分析输入条件类型（范围、数值、集合、布尔）
2. 为每个输入参数划分等价类
3. 有效等价类通常1个，无效等价类通常2-3个
4. 设计测试用例时，一个用例覆盖一个无效等价类 + 尽可能多的有效等价类

**口诀：**
- 有效聚合（多个有效等价类放在一起）
- 无效隔离（每个无效等价类单独测试）

---

### 2. 边界值选取技巧

**边界值类型：**
1. **参数边界**：输入范围的边界（如0-200）
2. **业务边界**：影响业务逻辑的边界（如60分及格）
3. **数据类型边界**：int最大值、最小值

**测试值选取：**
```
[下边界-1, 下边界, 下边界+1, ..., 上边界-1, 上边界, 上边界+1]
```

---

### 3. 判定表简化技巧

**合并规则：**
- 如果两列的条件只有一个不同，但动作相同，可以合并
- 用"-"表示"无关"条件

**示例：**
```
原始：
R1: T T T → 动作A
R2: T F T → 动作A

简化：
R1: T - T → 动作A
```

---

### 4. 控制流图绘制技巧

**识别节点类型：**
- **顺序语句**：可以合并为一个节点
- **判定语句**：if、while、for → 判定节点（有多个出口）
- **跳转语句**：return、break → 直接指向出口

**计算技巧：**
```
V(G) = 判定节点数 + 1
```
（最快的方法，数if、while等判定语句）

---

### 5. 覆盖率计算技巧

**语句覆盖：**
```
覆盖率 = 执行的语句数 / 总语句数
```
设计测试用例时，尽量让每条语句至少执行一次。

**判定覆盖：**
```
覆盖率 = 执行的分支数 / 总分支数
```
- n个if语句 → 2n个分支
- 设计测试用例时，确保每个if的true和false分支都执行

---

### 6. 常见易错点

| 易错点 | 错误做法 | 正确做法 |
|-------|---------|---------|
| **等价类划分** | 只考虑有效等价类 | 有效+无效都要考虑 |
| **边界值** | 只测试边界值本身 | 边界值±1都要测试 |
| **判定表** | 条件顺序混乱 | 按2^n枚举所有组合 |
| **控制流图** | 忘记判定节点的两个分支 | 每个判定都有T和F两个出口 |
| **覆盖率** | 混淆语句覆盖和判定覆盖 | 语句看执行，判定看分支 |

---

## 扩展练习

### 练习1：三角形问题

输入三条边a、b、c，判断能否构成三角形，如果能，判断是等边、等腰还是一般三角形。

**要求：**
1. 使用等价类划分设计测试用例
2. 使用边界值分析设计测试用例

### 练习2：登录功能测试

用户名：6-20个字符，只能包含字母、数字、下划线
密码：8-16个字符，必须包含大小写字母和数字

**要求：**
1. 使用等价类划分设计测试用例
2. 使用边界值分析设计测试用例

### 练习3：计算折扣

购买金额discount规则：
- 金额 < 100：无折扣
- 100 ≤ 金额 < 500：9折
- 500 ≤ 金额 < 1000：8折
- 金额 ≥ 1000：7折

**要求：**
1. 绘制控制流图
2. 计算环路复杂度
3. 设计测试用例达到判定覆盖

---

## 总结

### 黑盒测试 vs 白盒测试

| 对比项 | 黑盒测试 | 白盒测试 |
|-------|---------|---------|
| **关注点** | 功能、输入输出 | 代码结构、逻辑 |
| **测试依据** | 需求规格说明 | 程序代码 |
| **测试人员** | 不需要编程知识 | 需要编程知识 |
| **主要方法** | 等价类、边界值、判定表 | 语句覆盖、判定覆盖、路径覆盖 |
| **优点** | 从用户角度测试 | 覆盖更全面 |
| **缺点** | 无法发现隐藏的代码缺陷 | 无法发现需求遗漏 |

**最佳实践：** 黑盒测试 + 白盒测试相结合

